{% extends "base.html" %}

{% load wagtailcore_tags %}

{% block content %}
<h1>
    {{ page.title }}
</h1>

{{ page.intro | richtext }}

<form action="" method="POST">
    {% csrf_token %}
    {% if form.non_field_errors %}
        <ul>
        {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
        {% endfor %}
        </ul>
    {% endif %}

    <!-- first name -->
    {{ form.first_name.label_tag }}
    {% if registration_form.first_name.label_tag.errors %}
        <ul>
            {% for error in form.first_name.label_tag.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    {{ form.first_name }}
    {% if field.help_text %}
        <br />{{ field.help_text }}
    {% endif %}


    <!-- last name -->
    {{ form.last_name.label_tag }}
    {% if registration_form.last_name.label_tag.errors %}
        <ul>
            {% for error in form.last_name.label_tag.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    {{ form.last_name }}
    {% if field.help_text %}
        <br />{{ field.help_text }}
    {% endif %}
    <br />

    <!-- age -->
    {{ form.age.label_tag }}
    {% if registration_form.age.label_tag.errors %}
        <ul>
            {% for error in form.age.label_tag.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    {{ form.age }}
    {% if field.help_text %}
        <br />{{ field.help_text }}
    {% endif %}
    <br />

    <!-- email -->
    {{ form.email.label_tag }}
    {% if registration_form.email.label_tag.errors %}
        <ul>
            {% for error in form.email.label_tag.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    {{ form.email }}
    {% if field.help_text %}
        <br />{{ field.help_text }}
    {% endif %}
    <br />

    <!-- memorial meeting only -->
    {{ form.attending_memorial_meeting_only.label_tag }}
    {% if registration_form.attending_memorial_meeting_only.label_tag.errors %}
        <ul>
            {% for error in form.attending_memorial_meeting_only.label_tag.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    {{ form.attending_memorial_meeting_only }}
    {% if field.help_text %}
        <br />{{ field.help_text }}
    {% endif %}
    <br />

    <!-- ADA accessible accommodations -->
    {{ form.needs_ada_accessible_accommodations.label_tag }}
    {% if registration_form.needs_ada_accessible_accommodations.label_tag.errors %}
        <ul>
            {% for error in form.needs_ada_accessible_accommodations.label_tag.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    {{ form.needs_ada_accessible_accommodations }}
    {% if field.help_text %}
        <br />{{ field.help_text }}
    {% endif %}
    <br />

    <!-- days attending -->
    {{ form.days_attending.label_tag }}
    {% if registration_form.days_attending.label_tag.errors %}
        <ul>
            {% for error in form.days_attending.label_tag.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    {{ form.days_attending }}
    {% if field.help_text %}
        <br />{{ field.help_text }}
    {% endif %}
    <br />

    <!-- overnight accommodations -->
    {{ form.overnight_accommodations.label_tag }}
    {% if registration_form.overnight_accommodations.label_tag.errors %}
        <ul>
            {% for error in form.overnight_accommodations.label_tag.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    {{ form.overnight_accommodations }}
    {% if field.help_text %}
        <br />{{ field.help_text }}
    {% endif %}
    <br />

    <button type="submit">Register</button>
</form>
{% endblock content %}

{% block extra_js %}
<script>
var overnightAccommodationsInputs = $("#id_overnight_accommodations input");

function hideAccommodationOptions() {
    overnightAccommodationsInputs.parent().parent().hide();
};

function accommodationIsEligible (index, element) {
    var registrantAge = parseInt($("#id_age").val());

    var ageMin = parseInt($(element).attr("data-age-min"));
    var ageMax = parseInt($(element).attr("data-age-max"));

    if (registrantAge) {
        var oldEnough = registrantAge >= ageMin;
        var youngEnough = registrantAge <= ageMax;

        return oldEnough && youngEnough;
    }
};

function showEligibleAccommodations(event) {
    var eligibleAccommodations = $("#id_overnight_accommodations input").filter(accommodationIsEligible);

    hideAccommodationOptions();

    eligibleAccommodations.parent().parent().show();
};

$(document).ready(function () {
    hideAccommodationOptions();
});

$("#id_age").on("input", showEligibleAccommodations);
</script>
{% endblock extra_js %}